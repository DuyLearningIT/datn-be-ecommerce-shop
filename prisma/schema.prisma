generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model attribute_values {
  id             Int              @id @default(autoincrement())
  attribute_id   Int
  value          String           @db.VarChar(100)
  attributes     attributes       @relation(fields: [attribute_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "attribute_values_ibfk_1")
  variant_values variant_values[]

  @@unique([attribute_id, value], map: "idx_attr_value")
}

model attributes {
  id               Int                @id @default(autoincrement())
  name             String             @unique(map: "name") @db.VarChar(100)
  attribute_values attribute_values[]
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model cart_items {
  id               Int              @id @default(autoincrement())
  cart_id          Int
  variant_id       Int
  quantity         Int
  carts            carts            @relation(fields: [cart_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "cart_items_ibfk_1")
  product_variants product_variants @relation(fields: [variant_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "cart_items_ibfk_2")

  @@unique([cart_id, variant_id], map: "idx_cart_variant")
  @@index([variant_id], map: "variant_id")
}

model carts {
  id         Int          @id @default(autoincrement())
  user_id    Int          @unique(map: "user_id")
  created_at DateTime?    @db.DateTime(0)
  updated_at DateTime?    @db.DateTime(0)
  cart_items cart_items[]
  users      users        @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "carts_ibfk_1")
}

model categories {
  id                 Int          @id @default(autoincrement())
  name               String       @db.VarChar(255)
  parent_category_id Int?
  created_at         DateTime?    @db.DateTime(0)
  updated_at         DateTime?    @db.DateTime(0)
  categories         categories?  @relation("categoriesTocategories", fields: [parent_category_id], references: [id], onUpdate: NoAction, map: "categories_ibfk_1")
  other_categories   categories[] @relation("categoriesTocategories")
  products           products?

  @@index([parent_category_id], map: "parent_category_id")
}

model chat_messages {
  id              BigInt    @id @default(autoincrement())
  sender_id       Int
  message_content String    @db.Text
  sent_at         DateTime? @db.DateTime(0)
  users           users     @relation(fields: [sender_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "chat_messages_ibfk_2")

  @@index([sender_id], map: "sender_id")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model knowledge_base {
  id                 Int                        @id @default(autoincrement())
  source_type        knowledge_base_source_type
  source_id          String?                    @db.VarChar(255)
  content            String                     @db.Text
  last_vectorized_at DateTime?                  @db.DateTime(0)
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model order_items {
  id                Int              @id @default(autoincrement())
  order_id          Int
  variant_id        Int
  quantity          Int
  price_at_purchase Decimal          @db.Decimal(10, 2)
  orders            orders           @relation(fields: [order_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "order_items_ibfk_1")
  product_variants  product_variants @relation(fields: [variant_id], references: [id], onUpdate: NoAction, map: "order_items_ibfk_2")

  @@index([order_id], map: "order_id")
  @@index([variant_id], map: "variant_id")
}

model orders {
  id               Int           @id @default(autoincrement())
  user_id          Int
  total_amount     Decimal       @db.Decimal(10, 2)
  status           orders_status @default(pending)
  shipping_address String        @db.Text
  created_at       DateTime?     @db.DateTime(0)
  updated_at       DateTime?     @db.DateTime(0)
  order_items      order_items[]
  users            users         @relation(fields: [user_id], references: [id], onUpdate: NoAction, map: "orders_ibfk_1")
  payments         payments[]

  @@index([user_id], map: "user_id")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model payments {
  id             Int             @id @default(autoincrement())
  order_id       Int
  payment_method String          @db.VarChar(50)
  transaction_id String?         @db.VarChar(255)
  amount         Decimal         @db.Decimal(10, 2)
  status         payments_status @default(pending)
  created_at     DateTime?       @default(now()) @db.Timestamp(0)
  orders         orders          @relation(fields: [order_id], references: [id], onUpdate: NoAction, map: "payments_ibfk_1")

  @@index([order_id], map: "idx_payments_order")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model product_image_vectors {
  id               Int              @id @default(autoincrement())
  variant_id       Int
  image_url        String           @db.VarChar(512)
  vector_db_id     String           @unique(map: "vector_db_id") @db.VarChar(255)
  created_at       DateTime?        @db.DateTime(0)
  product_variants product_variants @relation(fields: [variant_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "product_image_vectors_ibfk_1")

  @@index([vector_db_id], map: "idx_image_vector_id")
  @@index([variant_id], map: "variant_id")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model product_variants {
  id                    Int                     @id @default(autoincrement())
  product_id            Int
  price                 Decimal                 @db.Decimal(10, 2)
  stock_quantity        Int                     @default(0)
  main_image_url        String?                 @db.VarChar(512)
  created_at            DateTime?               @db.DateTime(0)
  updated_at            DateTime?               @db.DateTime(0)
  cart_items            cart_items[]
  order_items           order_items[]
  product_image_vectors product_image_vectors[]
  products              products                @relation(fields: [product_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "product_variants_ibfk_1")
  variant_values        variant_values[]

  @@index([product_id], map: "product_id")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model products {
  id               Int                @id @default(autoincrement())
  category_id      Int
  name             String             @db.VarChar(255)
  description      String?            @db.Text
  base_price       Decimal            @default(0.00) @db.Decimal(10, 2)
  created_at       DateTime?          @db.DateTime(0)
  updated_at       DateTime?          @db.DateTime(0)
  product_variants product_variants[]
  categories       categories         @relation(fields: [id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "id")

  @@index([category_id], map: "category_id")
  @@index([name], map: "idx_products_name")
}

model user_profiles {
  user_id      Int     @id
  full_name    String? @db.VarChar(255)
  address      String? @db.Text
  phone_number String? @unique(map: "phone_number") @db.VarChar(20)
  avatar_url   String? @db.VarChar(512)
  users        users   @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "user_profiles_ibfk_1")
}

model users {
  id              Int             @id @default(autoincrement())
  email           String          @unique(map: "email") @db.VarChar(255)
  hashed_password String          @db.VarChar(255)
  role            users_role      @default(user)
  created_at      DateTime?       @default(now()) @db.Timestamp(0)
  updated_at      DateTime?       @default(now()) @db.Timestamp(0)
  carts           carts?
  chat_messages   chat_messages[]
  orders          orders[]
  user_profiles   user_profiles?

  @@index([email], map: "idx_users_email")
}

model variant_values {
  variant_id         Int
  attribute_value_id Int
  product_variants   product_variants @relation(fields: [variant_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "variant_values_ibfk_1")
  attribute_values   attribute_values @relation(fields: [attribute_value_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "variant_values_ibfk_2")

  @@id([variant_id, attribute_value_id])
  @@index([attribute_value_id], map: "attribute_value_id")
}

enum knowledge_base_source_type {
  product
  policy
  faq
}

enum orders_status {
  pending
  paid
  shipped
  delivered
  cancelled
}

enum users_role {
  user
  staff
  admin
}

enum payments_status {
  pending
  success
  failed
}
